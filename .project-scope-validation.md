# Project Scope Validation Rules

**Created**: 2025-11-28
**Purpose**: Prevent accidental project-switching during development

---

## Project Identity Validation

### ✅ THIS PROJECT IS:
- **Name**: mcp-smartthings
- **Path**: `/Users/masa/Projects/mcp-smartthings`
- **Language**: TypeScript 5.6+
- **Package**: `@bobmatnyc/mcp-smarterthings`
- **Purpose**: SmartThings/Tuya/Lutron device control via MCP

### ❌ THIS PROJECT IS NOT:
- **EDGAR Platform** (separate Python project for code generation)
- **Weather API tools** (part of EDGAR)
- **Any Python code generation system**
- **Any project outside this directory**

---

## Scope Validation Checklist

Before starting ANY task, validate:

```typescript
function isInScope(task: Task): boolean {
  // ✅ PASS: Work is in this repository
  if (task.workingDirectory === '/Users/masa/Projects/mcp-smartthings') {
    return true;
  }

  // ✅ PASS: TypeScript/JavaScript implementation
  if (task.language === 'TypeScript' || task.language === 'JavaScript') {
    return true;
  }

  // ❌ FAIL: References EDGAR platform
  if (task.description.includes('EDGAR')) {
    console.error('⚠️ SCOPE VIOLATION: EDGAR is a separate project');
    return false;
  }

  // ❌ FAIL: Python code generation
  if (task.description.includes('Python') && task.description.includes('code generation')) {
    console.error('⚠️ SCOPE VIOLATION: Python code gen is EDGAR (separate project)');
    return false;
  }

  // ❌ FAIL: Weather API extractor
  if (task.description.includes('weather API extractor')) {
    console.error('⚠️ SCOPE VIOLATION: Weather API is EDGAR Phase 1 (separate project)');
    return false;
  }

  // ❌ FAIL: Creating new projects
  if (task.description.includes('create new project') || task.description.includes('new repository')) {
    console.error('⚠️ SCOPE VIOLATION: Stay in THIS project only');
    return false;
  }

  return true;
}
```

---

## Linear Ticket Scope Classification

### ✅ IN-SCOPE TICKETS (Safe to Work On)

**Semantic Device Features**:
- 1M-275: Semantic Device Indexing (TypeScript, THIS project)
- 1M-281: LLM-based IntentClassifier (TypeScript, THIS project)
- 1M-282: DiagnosticWorkflow orchestrator (TypeScript, THIS project)
- 1M-283: ChatOrchestrator integration (TypeScript, THIS project)

**Platform Integrations**:
- 1M-341: Tuya Platform Support (TypeScript adapter, THIS project)
- 1M-340: Lutron Caseta Support (TypeScript adapter, THIS project)
- 1M-342: Unified Device Abstraction (TypeScript, THIS project)

**SmarterScript Automation**:
- 1M-349: SmarterScript Engine (TypeScript, THIS project)
- 1M-350-354: SmarterScript POCs (TypeScript, THIS project)

**MCP Tools & Infrastructure**:
- All MCP tool implementations in `src/mcp/tools/`
- Device registry enhancements
- Capability mappings

### ❌ OUT-OF-SCOPE TICKETS (DIFFERENT PROJECT)

**EDGAR Platform (Python Code Generation)**:
- ⛔ 1M-325: Sonnet 4.5 Integration (Python, EDGAR project)
- ⛔ 1M-318: Weather API POC (Python, EDGAR Phase 1)
- ⛔ 1M-328: Weather API Extractor Generation (Python, EDGAR)
- ⛔ 1M-323-327: EDGAR infrastructure (Python, separate repo)
- ⛔ 1M-343-344: Weather data extraction (Python, EDGAR)

**Why Out-of-Scope**:
- Different technology stack (Python vs TypeScript)
- Different purpose (code generation vs device control)
- Different repository (not yet created)
- Separate Linear epic (EDGAR platform epic)

---

## Violation Response Protocol

### When Scope Violation Detected:

**Step 1: STOP Immediately**
```
⚠️ SCOPE VIOLATION DETECTED ⚠️

Ticket: 1M-XXX
Issue: [Ticket mentions EDGAR/Python/Weather API]
Reason: This is for EDGAR platform (separate Python project)

THIS PROJECT: mcp-smartthings (TypeScript device control)
BLOCKED WORK: EDGAR platform (Python code generation)
```

**Step 2: Clarify with User**
```
This ticket appears to be for a different project (EDGAR platform).

EDGAR is a separate Python code generation tool, not part of mcp-smartthings.

Options:
1. Skip this ticket and work on mcp-smartthings tasks (recommended)
2. Explicitly confirm you want to create the EDGAR project
3. Update work plan to exclude EDGAR tickets

Which would you prefer?
```

**Step 3: Document and Skip**
```
Added scope violation note to ticket:
"This ticket is for EDGAR platform (separate Python project).
Not applicable to mcp-smartthings TypeScript codebase.
Skipped during mcp-smartthings work session."
```

---

## Project Boundary Examples

### ✅ CORRECT: Staying In-Scope

```
User: "Implement semantic device search with ChromaDB"
Agent: ✅ This is in-scope for mcp-smartthings
  - Uses existing SemanticIndex service
  - TypeScript implementation
  - Enhances device discovery features
  - Work stays in THIS repository

Action: Proceed with implementation
```

### ❌ INCORRECT: Scope Violation

```
User: "Implement Sonnet 4.5 integration for code generation"
Agent: ⚠️ SCOPE VIOLATION DETECTED
  - Ticket 1M-325 mentions EDGAR platform
  - Python code generation system
  - Separate project (not mcp-smartthings)
  - Would require creating new repository

Action: STOP and clarify with user
```

---

## Multi-Project Workspace Detection

### Detecting Separate Projects in Same Linear Workspace

**Indicators of Different Projects**:
1. Different technology stacks (Python vs TypeScript)
2. Different purposes (code generation vs device control)
3. Different parent epics (EDGAR epic vs MCP Smarterthings epic)
4. Different repository requirements (new repo vs existing)

**Example: 1M-325 Analysis**:
```
Ticket: 1M-325
Parent Issue: 1M-318 (Weather API POC)
Parent Epic: EDGAR Platform (4a248615-f1dd-4669-9f61-edec2d2355ac)

⚠️ Different Epic = Different Project
⚠️ "EDGAR Platform" != "MCP Smarterthings"
⚠️ Python != TypeScript

Conclusion: OUT OF SCOPE for mcp-smartthings work
```

---

## Validation Rules Summary

| Check | In-Scope | Out-of-Scope |
|-------|----------|--------------|
| **Working Directory** | `/Users/masa/Projects/mcp-smartthings` | Other directories |
| **Language** | TypeScript, JavaScript | Python |
| **Technology** | Node.js, MCP, SmartThings SDK | Code generation, EDGAR |
| **Purpose** | Device control, automation | Python code generation |
| **Epic** | MCP Smarterthings (4bfcd979) | EDGAR Platform (4a248615) |
| **Repository** | This repository | New/separate repos |

---

## Enforcement Mechanism

### Pre-Task Validation

```typescript
async function validateTaskScope(ticket: LinearTicket): Promise<ValidationResult> {
  const violations: string[] = [];

  // Check 1: Epic validation
  if (ticket.parentEpic !== '4bfcd979-73bb-4098-8d09-2e2e1b9fc69c') {
    violations.push('Ticket is not under MCP Smarterthings epic');
  }

  // Check 2: Technology validation
  if (ticket.description.toLowerCase().includes('python')) {
    violations.push('Ticket requires Python (mcp-smartthings is TypeScript)');
  }

  // Check 3: EDGAR detection
  if (ticket.description.toLowerCase().includes('edgar')) {
    violations.push('Ticket references EDGAR (separate project)');
  }

  // Check 4: Code generation detection
  if (ticket.description.toLowerCase().includes('code generation')) {
    violations.push('Code generation is out of scope (EDGAR project)');
  }

  return {
    valid: violations.length === 0,
    violations,
    action: violations.length > 0 ? 'STOP_AND_CLARIFY' : 'PROCEED'
  };
}
```

### Continuous Monitoring

**During implementation, verify**:
- All file changes are in `/Users/masa/Projects/mcp-smartthings/`
- All code is TypeScript/JavaScript
- All dependencies are Node.js packages
- No new Python files created
- No new repositories initialized

---

## Recovery from Scope Violations

### If Scope Violation Already Occurred:

1. **STOP all work immediately**
2. **Rollback** any changes to wrong project
3. **Document** the violation in project log
4. **Clarify** correct scope with user
5. **Resume** with validated in-scope work

### Example Recovery:

```
⚠️ Detected scope violation at timestamp 2025-11-28T12:00:00Z

Violation Details:
- Started working on EDGAR platform (Python project)
- Created files outside mcp-smartthings directory
- Attempted to switch to different technology stack

Recovery Actions:
1. ✅ Stopped EDGAR work immediately
2. ✅ Documented clarification in Linear ticket 1M-325
3. ✅ Added scope validation rules to .project-context.md
4. ✅ Clarified with user: "Focus on mcp-smartthings only"
5. ✅ Ready to resume in-scope work (Semantic Indexing Phase 2)

Status: Recovered, ready to proceed with mcp-smartthings work
```

---

## Success Metrics

**Project Boundary Integrity**:
- ✅ 100% of work stays in `/Users/masa/Projects/mcp-smartthings/`
- ✅ 0 scope violations per session
- ✅ All tickets validated before starting
- ✅ Clear separation between mcp-smartthings and EDGAR

**Validation Effectiveness**:
- ✅ Automatic detection of out-of-scope tickets
- ✅ User clarification before questionable work
- ✅ Documentation of scope boundaries
- ✅ Rapid recovery from violations

---

**Last Updated**: 2025-11-28
**Applies To**: All mcp-smartthings development sessions
**Enforcement**: MANDATORY - No exceptions without explicit user override
